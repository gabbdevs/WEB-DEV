<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cart | OTL™</title>
  <link rel="stylesheet" href="cart.css">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <header class="navbar">
    <div class="nav-left">
      <a href="index.html">
        <img src="img/MiniLogo.png" alt="OTL Logo" class="otl-Minilogo">
      </a>
    </div>

    <nav class="nav-right">
      <div class="nav-links">
        <a href="index.html" class="nav-link">HOME</a>
        <a href="shop.html" class="nav-link">SHOP</a>
        <a href="brand.html" class="nav-link">BRAND</a>
        <a href="contact.html" class="nav-link">CONTACT</a>
        <a href="about.html" class="nav-link">ABOUT</a>
      </div>

      <div class="nav-icons">
        <div class="icon search-container">
          <img src="img/search.png" alt="Search" id="searchIcon">
          <form id="searchForm">
            <input type="text" id="searchInput" placeholder="Search..." />
            <button type="submit" style="display: none;"></button>
          </form>
        </div>

        <div class="icon">
          <a href="login.html" id="profileBtn">
            <img src="img/people.png" alt="Profile" id="profileIcon">
          </a>
        </div>

        <div class="icon active">
          <a href="cart.html" id="cartBtn">
            <img src="img/shopping-cart.png" alt="Cart" id="cartIcon">
          </a>
        </div>
      </div>
    </nav>
  </header>

  <h1>Your Cart</h1>
  <div id="cartContainer"></div>
  <p id="total"></p>
  <button id="checkoutBtn">Proceed to Payment</button>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const cartContainer = document.getElementById("cartContainer");
      const totalEl = document.getElementById("total");
      const checkoutBtn = document.getElementById("checkoutBtn");

      // Load cart from localStorage
      let cart = JSON.parse(localStorage.getItem("cart")) || [];

      // Render cart items
      function renderCart() {
        cartContainer.innerHTML = "";
        let total = 0;

        if (cart.length === 0) {
          cartContainer.innerHTML = "<p>Your cart is empty.</p>";
          totalEl.textContent = "";
          return;
        }

        cart.forEach((item, index) => {
          // Ensure price and quantity are numbers
          const price = Number(item.price) || 0;
          const quantity = Number(item.quantity) || 1;
          const itemTotal = price * quantity;
          total += itemTotal;

          const div = document.createElement("div");
          div.classList.add("cart-item");
          div.innerHTML = `
          <img src="${item.imgSrc}" alt="${item.name}">
          <div class="item-info">
            <p>${item.name}</p>
            <p>₱${price.toFixed(2)} x ${quantity} = ₱${itemTotal.toFixed(2)}</p>
          </div>
          <button class="remove-btn" data-index="${index}">&times;</button>`;
          cartContainer.appendChild(div);
        });

        totalEl.textContent = "Total: ₱" + total.toFixed(2);

        // Remove item functionality
        const removeButtons = document.querySelectorAll(".remove-btn");
        removeButtons.forEach(btn => {
          btn.addEventListener("click", (e) => {
            const idx = parseInt(e.target.getAttribute("data-index"));
            cart.splice(idx, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            renderCart();
          });
        });
      }

      // Initial render
      renderCart();

      // Checkout button click
      checkoutBtn.addEventListener("click", () => {
        if (cart.length === 0) {
          alert("Your cart is empty!");
          return;
        }

        // Save cart to localStorage as numbers (important for receipt)
        cart = cart.map(item => 
        {
            const product = window.PRODUCTS.find(p => p.id === item.id);
            return {
              id: item.id,
              name: item.name,
              price: product ? product.price : 0,
              quantity: Number(item.quantity),
              img: item.imgSrc || item.img
            };
        });

        localStorage.setItem("cart", JSON.stringify(cart));
        // Redirect to payment page
        window.location.href = "payment.html";
      });
    });
  </script>

<script src="web.js"></script>
</body>
     
</html>